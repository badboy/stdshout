<!DOCTYPE html

<html>
  <head>
    <title>A shell that shouts at you</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="public/custom.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
  </head>
  <body>
    <textarea id="source">

class: middle

# A shell that shouts at you

## { EnthusiastiCon }

## Jan-Erik Rediger — [@badboy_](https://twitter.com/badboy_) — 2019-05-25

<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img class="license" src="media/cc-by-nc-sa.svg"></a>

---

> @Argorak tweeted:
>
> stdshout
>
> (Feb 28, 2017)


.footnote[[Tweet Link](https://twitter.com/Argorak/status/836532440420204544)]

---

> @pobocks replying to [@Argorak](https://twitter.com/Argorak/status/836532440420204544):
>
> now I kind of want a magic fd that assumes utf-8 and upcases everything and appends !!!1! to it.
>
> (Feb 28, 2017)

.footnote[[Tweet Link](https://twitter.com/pobocks/status/836534631822409728)]

---

class: middle, center

# WAAAAAH!!!1!

---

class: middle

# What if ...?
# <span style="visibility:hidden">we can do that for every output?</span>

---

class: middle

# What if ...
# we can do that for every output?

---

# Everything is a file

---

# Everything is a file descriptor

---

# Everything is a file description

---

# stdin
--

# stdout
--

# stderr


---

# stdin = 0

# stdout = 1

# stderr = 2

---
class: center, middle

# close(stdout)

---
class: center, middle

# puts("Hello, World!")

---

---

background-image: url(media/were-closed.jpg)
background-size: cover

.sfootnote[by [Nick Papakyriazis](https://www.flickr.com/photos/mlrs193/6015396482), [CC BY-NC-SA](https://creativecommons.org/licenses/by-nc-sa/2.0/)]

---
class: center, middle

# fd = open("file.txt", O_CREAT, S_IRUSR)

---
class: center, middle

# fd = ?

---
class: center, middle

# fd = 1

---
class: center, middle

# puts("Hello, World!")

---

---

class: middle

# $ cat file.txt
# Hello, World!

---

class: middle

# ... and now for something completely different

---

class: middle

# Run before everything everything else

---

# LD_PRELOAD

.footnote[Jess Fraz's [LD_PRELOAD: The Hero We Need and Deserve](https://blog.jessfraz.com/post/ld_preload/)]

---

class: middle, center

# STDSHOUT!!!1!

.footnote[<i class="fab fa-github"></i>/badboy/stdshout]

---

# $ echo hello, enthusiasticon | stdshout
# HELLO, ENTHUSIASTICON!!!1!

---

## "hello enthusiasticon".to_uppercase()
## # => "HELLO ENTHUSIASTICON"

--

<span style="visibility:hidden">hidden</span>
## "hello enthusiasticon".to_uppercase() + "!!!1!"
## # => "HELLO ENTHUSIASTICON!!!1!"

---

class: middle

```
fn shout(msg: &str) -> String {
    msg.to_uppercase() + "!!!1!"
}

```

---

class: middle

```
fn main() {
    puts(shout(stdin.read()));
}

```

---

# $ echo hello, enthusiasticon | stdshout
# HELLO, ENTHUSIASTICON!!!1!

---

class: middle

# Run before everything everything else?

---

```
#[ctor]
fn reopen_stdout() {
    // start shouting
}
```

---

```
#[ctor]
fn reopen_stdout() {
    // find stdshout exe
```

--

```
    // save current stdout
```

--

```
    // replace stdout
```

---

```
fn reopen_stdout() {
    // find stdshout exe
    // save current stdout
    // replace stdout
```

---

```
    // find stdshout exe
    // save current stdout
    // replace stdout
```

--

```
    // fork
```

--

```
    // (child) read <=> stdin
```

---

```
    // save current stdout
    // replace stdout
    // fork
    // (child) read <=> stdin
```

---

```
    // replace stdout
    // fork
    // (child) read <=> stdin
```

--

```
    // exec stdshout
```

---

# $ make run

---


# $ echo hello, enthusiasticon
# HELLO, ENTHUSIASTICON!!!1!

---

# $ git status
# ON BRANCH MASTER!!!1!
# YOUR BRANCH IS UP TO DATE WITH 'U/MASTER'

---

background-size: contain
background-image: url(media/git-log.png)

---

class: middle, center

# A shell that shouts at you

## [STDSHOUT!!1!](https://github.com/badboy/stdshout)
## <i class="fab fa-github"></i>/badboy/stdshout

  </textarea>
    <script src="public/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({
        ratio: '16:9',
        slideNumberFormat: '',
        highlightSpans: true,
        highlightLanguage: "no-highlight"
      });
      <!--slideshow.togglePresenterMode();-->

      var fixline_elem = document.querySelector(".fixhighlight .remark-code > .remark-code-line");
      fixline_elem.innerHTML = fixline_elem.innerHTML.trim();


      document.querySelector("button").onclick = function(e) {
        fetch('half.wasm')
        .then(data => data.arrayBuffer())
        .then(buf => WebAssembly.compile(buf))
        .then(mod => WebAssembly.instantiate(mod))
        .then(ins => alert(ins.exports.half(128)))
      }
    </script>

    <div class="footer">
      Jan-Erik / @badboy_ / EnthusiastiCon 2019
    </div>
  </body>
</html>
