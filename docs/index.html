<!DOCTYPE html

<html>
  <head>
    <title>A shell that shouts at you</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="public/custom.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
  </head>
  <body>
    <textarea id="source">

class: middle

# A shell that shouts at you

## { EnthusiastiCon }

## Jan-Erik Rediger — [@badboy_](https://twitter.com/badboy_) — 2019-05-25

<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img class="license" src="media/cc-by-nc-sa.svg"></a>

???

Hi!

I'm here to talk about a shell that shouts at you.

And how a tweet got me into writing 100 lines of Rust code.

---

> @Argorak tweeted:
>
> stdshout
>
> (Feb 28, 2017)


.footnote[[Tweet Link](https://twitter.com/Argorak/status/836532440420204544)]

???

2 years ago a friend of mine,

florian aka argorak

tweeted a single word:

stdshout.

---

> @pobocks replying to [@Argorak](https://twitter.com/Argorak/status/836532440420204544):
>
> now I kind of want a magic fd that assumes utf-8 and upcases everything and appends !!!1! to it.
>
> (Feb 28, 2017)

.footnote[[Tweet Link](https://twitter.com/pobocks/status/836534631822409728)]

???

and someone else replied:

[read tweet]

---

class: middle, center

# Well ...

???

Well

[pause]

---

class: middle

# What if ...?
# <span style="visibility:hidden">we can do that for every output?</span>

???

What if

[pause]

---

class: middle

# What if ...
# we can do that for every output?

???

What if we can do that for every output

of every program

started from your shell

---

# Everything is a file

???

as you might have heard

everything is a file

---

# Everything is a file descriptor

???

and everything is identified by a file descriptor

actually it's just a number

---

# Everything is a file description

???

Now to extend the confusion

the linux kernel has file descriptions internally

---


???

even if you never really directly used file descriptors

you have interacted with the standard ones

---

# stdin
???

3 exist

stdin is the input

usually your keyboard
--

# stdout
???

stdout is the output

that's what you see in your terminal when you print stuff
--

# stderr

???

and then there is stderr

it's also connected to the output, your terminal

but with small differences

---

# stdin = 0

# stdout = 1

# stderr = 2

???

now all three actually have file descriptors

which are just numbers

one

two

three

and none of these are actually special

they act just the same as a file descriptor for a file

---
class: center, middle

# close(stdout)

???

for example you can stdout

---
class: center, middle

# puts("Hello, World!")

???

now what happens if you try to print something to the terminal?

---

???

[pause]

nothing

---

background-image: url(media/were-closed.jpg)
background-size: cover

.sfootnote[by [Nick Papakyriazis](https://www.flickr.com/photos/mlrs193/6015396482), [CC BY-NC-SA](https://creativecommons.org/licenses/by-nc-sa/2.0/)]


???

we closed stdout

we can't print to it anymore

---
class: center, middle

# fd = open("file.txt", O_CREAT, S_IRUSR)

???

let's open another file called file.txt

yes, that is the low-level POSIX way to open a file in C

---
class: center, middle

# fd = ?

???

what is fd now?

yes, it is a number

but which?

---
class: center, middle

# fd = 1

???

linux is pretty simple

it just picks the lowest unused number

which is 1

remember: we previously closed what used to be 1

---
class: center, middle

# puts("Hello, World!")

???

now we print again

and what happens?

---

???

exactly

we still see nothing

stdout or fd 1 as we call it

is not our terminal anymore

---

class: middle

# $ cat file.txt
# Hello, World!

???

there we have our output

it's in the file we created

puts just writes to fd 1

and we controlled what is fd 1

---

class: middle

# ... and now for something completely different

???

but now for something completely different

---

class: middle

# Run before everything everything else

---

# LD_PRELOAD

.footnote[Jess Fraz's [LD_PRELOAD: The Hero We Need and Deserve](https://blog.jessfraz.com/post/ld_preload/)]

---

class: middle

# ... and now for something completely different

---

class: middle, center

# STDSHOUT!!!1!

.footnote[<i class="fab fa-github"></i>/badboy/stdshout]

---

# $ echo hello, enthusiasticon | stdshout
# HELLO, ENTHUSIASTICON!!!1!

---

## "hello enthusiasticon".to_uppercase()
## # => "HELLO ENTHUSIASTICON"

--

<span style="visibility:hidden">hidden</span>
## "hello enthusiasticon".to_uppercase() + "!!!1!"
## # => "HELLO ENTHUSIASTICON!!!1!"

---

class: middle

```
fn shout(msg: &str) -> String {
    msg.to_uppercase() + "!!!1!"
}

```

---

class: middle

```
fn main() {
    puts(shout(stdin.read()));
}

```

---

# $ echo hello, enthusiasticon | stdshout
# HELLO, ENTHUSIASTICON!!!1!

---

class: middle

# Run before everything everything else?

---

```
#[ctor]
fn reopen_stdout() {
    // start shouting
}
```

---

```
#[ctor]
fn reopen_stdout() {
    // find stdshout exe
```

--

```
    // save current stdout
```

--

```
    // replace stdout
```

---

```
fn reopen_stdout() {
    // find stdshout exe
    // save current stdout
    // replace stdout
```

---

```
    // find stdshout exe
    // save current stdout
    // replace stdout
```

--

```
    // fork
```

--

```
    // (child) read <=> stdin
```

---

```
    // save current stdout
    // replace stdout
    // fork
    // (child) read <=> stdin
```

---

```
    // replace stdout
    // fork
    // (child) read <=> stdin
```

--

```
    // exec stdshout
```

---

# $ make run

---


# $ echo hello, enthusiasticon
# HELLO, ENTHUSIASTICON!!!1!

---

# $ git status
# ON BRANCH MASTER!!!1!
# YOUR BRANCH IS UP TO DATE WITH 'U/MASTER'

---

background-size: contain
background-image: url(media/git-log.png)

---

> @Argorak tweeted:
>
> stdshout
>
> (Feb 28, 2017)


.footnote[[Tweet Link](https://twitter.com/Argorak/status/836532440420204544)]

---

class: center, withimg

# RustFest Barcelona 2019

![RustFest](media/rustfest.png)

## <https://rustfest.eu>

---

class: middle, center

# A shell that shouts at you

## [STDSHOUT!!1!](https://github.com/badboy/stdshout)
## <i class="fab fa-github"></i>/badboy/stdshout

## Jan-Erik Rediger — [@badboy_](https://twitter.com/badboy_)

  </textarea>
    <script src="public/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({
        ratio: '16:9',
        slideNumberFormat: '',
        highlightSpans: true,
        highlightLanguage: "no-highlight"
      });
      <!--slideshow.togglePresenterMode();-->

      var fixline_elem = document.querySelector(".fixhighlight .remark-code > .remark-code-line");
      fixline_elem.innerHTML = fixline_elem.innerHTML.trim();


      document.querySelector("button").onclick = function(e) {
        fetch('half.wasm')
        .then(data => data.arrayBuffer())
        .then(buf => WebAssembly.compile(buf))
        .then(mod => WebAssembly.instantiate(mod))
        .then(ins => alert(ins.exports.half(128)))
      }
    </script>

    <div class="footer">
      Jan-Erik / @badboy_ / EnthusiastiCon 2019
    </div>
  </body>
</html>
